---
title: マイクロサービス入門
tags:
- マイクロサービス
id: microservice-basics
---

# モノリシックの限界

- リリース・デプロイの調整、コミュニケーション問題
- 小さなリリース、大胆な意思決定が難しい
- オーナーシップ問題があり、自律的なプロダクト開発ができない、イノベーション阻害

# マイクロサービス

- 大きな組織でも小さな組織のような素早いプロダクト開発
- 上記を実現するようなアーキテクチャをマイクロサービスアーキテクチャ
    - 上記の文脈は削れば SOA (Service Oriented Architecture) とも見れる

## メリット

- 小さなチームへの責任と権限の委譲
- 頻繁なトライアンドエラー
- 高速且つ高精度な意思決定のサポート

## デメリット

- アプリケーションはシンプルになるが、システム全体は複雑化
- 個々のアプリケーション開発は楽になるが、全体の運用は極度に難化

# マイクロサービスの課題

- サービス同士を繋げるのが難しい（service discovery の問題）

# Service Mesh

分散アーキテクチャの運用を楽に。

- Envoy Proxy
- Istio

## 問題意識

- observability
    - Twitter 社のエンジニア発の概念
    - 分散システムをうまく運用するためにシステムの繋がり部分の挙動に注目して可視化・監視する
    - 取得すべき値や集約・ストレージの設計などがスコープ
- システム全体はどんな姿で、どのように動いているのか
    - サービス境界で何が起こっているのか？
        - RPS、status、リトライ・タイムアウト・サーキットブレーカの発動
    - あるリクエストを処理したサービスはどれで、その処理結果がどうだったのか
        - 分散トレーシング
- 効率的にシステム障害を解決したり、キャパシティプランニング
- 新規参入開発者が全体像を早期に把握
    - 組織の急速な成長
- オーナーシップ問題
    - 責任の分離
        - プロダクト開発社は基本的に自分たちのプロダクト・サービシに責任を持てる
    - SRE
        - しかしシステム全体は協調して動作させる必要があるので組織横断的なチームは必要
    - 横断的なチームがアプリケーションの細部を把握しなくてもシステム全体の動作を理解できる必要がある（中央で管理する必要性）

## 構成

アプリケーションの代わりにネットワーク層の仕事をする。  
メトリクス取得/送信、リトライ等の実行、分散トレーシング用のログの送信、service discovery、load balancing なども行う。  
以下の2つのコンポーネントで構成される。

- data-plane
    - proxy として上記タスクを実行
- control-plane
    - 各 proxy の管理を行う

https://speakerdeck.com/taiki45/observability-service-mesh-and-microservices?slide=38