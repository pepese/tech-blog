---
title: Pythonで機械学習 レコメンド編
tags:
- Python
- Machine Learning
- scikit-learn
- SVM
id: python-ml-recommendation
---

# レコメンドアルゴリズム

- 協調フィルタリング
    - ユーザの利用履歴を扱う
    - トランザクションデータ、ユーザ・アイテム行列
- ポピュラリティ
    - 所謂人気ランキング
- 内容ベースフィルタリング
    - 商品やユーザの属性情報を利用
- 上記のハイブリッド

[参考](https://www.slideshare.net/takemikami/ss-76817490)  
[参考](http://hivecolor.com/id/47)

## 協調フィルタリング

- メモリベース（近傍ベース）
    - ユーザ・商品行列をそのまま利用、モデルを作成しない
    - 以下の手法がある
        - ユーザベース
        - アイテムベース
    - スパース性（データサイズに対して意味のある情報が少ない、 0 が多い行列）の高いデータには適用し辛い
- モデルベース
    - ユーザ・商品行列をモデル構築に利用
    - 以下の手法がある
        - 特異値分解（SVD）
        - 行列因子分解
        - 確率的（ナイーブベイズ、ベイジアンネットワークなど）
        - 分類、回帰
- 上記のハイブリッド

狭義の協調フィルタリングは、近傍ベースを指す。

### メモリベース協調フィルタリング

メモリベース協調フィルタリングのコンセプトは、「類似度」。  
過去の利用履歴から似たもの同士を明らかにし、この類似度を使ってオススメ商品を推定する。  
類似度といった場合、ユーザ同士の類似度と商品同士の類似度の 2 つが考えられ、前者を使う場合をユーザベース、後者をアイテムベースと言って区別する。

- ユーザベース
    - ユーザーの行動履歴からユーザー間の類似度を計算し、おすすめするアイテムを決める手法
    - 例
        - Aさんに何かおすすめしたい、Aさんは商品a、商品b、商品cを買っている。
        - 同じような行動履歴のBさんは商品a、商品b、商品c、商品dを買っている、ということはAさんには商品dをおすすめできる

- アイテムベース
    - ユーザーの行動履歴からアイテム間の類似度を計算し、類似するアイテムをおすすめする手法
    - 例
        - 商品Aは商品Bと一緒に購入されることが多いから、商品Aの購入者に商品Bをおすすめしよう

#### ユーザベース

ユーザベース協調フィルタリングのロジックは、いわゆるkNN回帰という機械学習手法になります。
kNN（k-Nearest-Neighbor、k近傍法）を簡単に説明すると、推定する対象に最も特徴が似ているk個の観測値を参考にし、値を推定しようというものです。kNNは一般に分類問題に適用されることが多いですが、オススメ度のような連続値を推定する場合、明示的にkNN回帰と呼んでいます。

アルゴリズムの概要は以下の通り。

1. あるユーザと他のユーザの **類似度** を計算
2. 他のユーザ利用したアイテムのうち、ユーザAがまだ利用していないアイテムの集合を抽出
3. それらのアイテム群のうち、おすすめ度が高いアイテムのリストを返却
    - この選定の際に、類似度が高いユーザが利用したアイテムほど重みが高くなるようにする

[参考](http://ohke.hateblo.jp/entry/2017/09/22/230000)  
[参考](https://qiita.com/hik0107/items/96c483afd6fb2f077985)

#### アイテムベース

仮定1： Aさんが未評価のアイテム（=推薦候補）のうち、気に入る可能性が高いのはAさんが高く評価しているアイテムと類似したものだろう。  
仮定2： アイテム同士は評価のパターンが近ければ、類似していると言えるだろう。

[参考](http://ohke.hateblo.jp/entry/2017/09/29/230000)  
[参考](https://qiita.com/kotaroito/items/6acb58bb16b68a460af9)

# Python ライブラリ

- [crab](https://github.com/muricoca/crab)
    - オワコン
- [python-recsys](https://github.com/ocelma/python-recsys)
    - オワコン
- [nimfa](https://github.com/marinkaz/nimfa)
    - 近年の流行りであるNMF を使った手法は、レコメンデーションのライブラリとしては存在しないようですが、実装において肝になる行列の演算はライブラリとして提供されているので、こちらを使うことでそれほど困難なく実装は実現できそうです。実装アルゴリズムはかなり豊富で、Factorizationの実装だけでも10種類以上ありました。
- **scikit-surprise**
    - デファクト臭
    - [Github](https://github.com/NicolasHug/Surprise)
    - [Doc](https://pypi.python.org/pypi/scikit-surprise)
- **fastFM**
    - 更新は頻繁だが、アカデミック臭が強いような、、、いいけど
    - [Github](https://github.com/ibayer/fastFM)
    - [論文](http://www.jmlr.org/papers/volume17/15-355/15-355.pdf)

[scikit-surprise の参考](http://ohke.hateblo.jp/entry/2017/10/06/230000)

# scikit-surprise で実装

## 環境設定

```sh
$ pip install numpy scikit-surprise
```
